/

===============================================================
= JOB : ENT_INFA_LX_PR#TERDSPHEND_PR[(2200 08/25/21),(0AAAAAAAAAC5GDOT)].TERDSPHENDSALESHIER_PR
= USER : usigpbat
= JCLFILE : /data/inft/prd/usigdw/Scripts/bteq_load_dsp_hier_core_SALES_HIERARCHY.sh
= TWSRCMAP :
= AGENT : ENT_INFA_LX_PR [PRDLX401_DA]
= Job Number: 608202905
= Thu 08/26/2021 01:33:07 EDT
===============================================================

****** Setting profile for prdha177 ******
stty: standard input: Inappropriate ioctl for device
BTEQ 15.10.01.09 Thu Aug 26 01:33:07 2021 PID: 117944

+---------+---------+---------+---------+---------+---------+---------+----

.SET WIDTH 150 ;
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

-- put BTEQ in Transaction mode
.SET SESSION TRANSACTION BTET;
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

/***************** Error Handling ********************************/
.IF ERRORCODE <> 0 THEN .GOTO ERRORS
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
/***************** Error Handling ********************************/

.logon VAPR2/infsdspp,

*** Logon successfully completed.
*** Teradata Database Release is 15.10.07.27
*** Teradata Database Version is 15.10.07.41
*** Transaction Semantics are BTET.
*** Session Character Set Name is 'ASCII'.

*** Total elapsed time was 1 second.

+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

/***************** Error Handling ********************************/
.IF ERRORCODE <> 0 THEN .GOTO ERRORS
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
/***************** Error Handling ********************************/




-- DST / GA Table

CREATE VOLATILE TABLE DST ,NO FALLBACK ,
NO BEFORE JOURNAL,
NO AFTER JOURNAL,
CHECKSUM = DEFAULT,
DEFAULT MERGEBLOCKRATIO
(
AGY_BPID CHAR(10),
AGY_PRTY_ID BIGINT,
AGY_NM VARCHAR(200),
AGY_STD_CONTR_TYP VARCHAR(20),
AGY_LGCY_ID CHAR(10),
AGY_CONTR_ID BIGINT,
AGY_STUS VARCHAR(20),
GA_BPID CHAR(10),
GA_PRTY_ID BIGINT,
GA_NM VARCHAR(200),
GA_STD_CONTR_TYP VARCHAR(20),
GA_CONTR_ID BIGINT,
GA_AGY_REL_STRT_DT DATE ,
GA_AGY_REL_END_DT DATE,
GA_STUS VARCHAR(20)
)
PRIMARY INDEX (AGY_PRTY_ID)
ON COMMIT PRESERVE ROWS ;

*** Table has been created.
*** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-


/***************** Error Handling ********************************/
.IF ERRORCODE <> 0 THEN .GOTO ERRORS
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
/***************** Error Handling ********************************/



-- Load Distributors and GAs


INSERT INTO DST


SELECT AGY.AGY_BPID
, AGY.AGY_PRTY_ID
, AGY.AGY_NM
, AGY.AGY_STD_CONTR_TYP
, AGY.AGY_LGCY_ID
, AGY.AGY_CONTR_ID
, AGY.AGY_STUS
, GA.GA_BPID
, GA.GA_PRTY_ID
, GA.GA_NM
, GA.GA_STD_CONTR_TYP
, GA.GA_CONTR_ID
, GA.GA_AGY_REL_STRT_DT
, GA.GA_AGY_REL_END_DT
, GA.GA_STUS

FROM

(

SELECT AGY.CHLD_BPID AS AGY_BPID
, AGY.CHLD_PRTY_ID AS AGY_PRTY_ID
, NM.FULL_NM AS AGY_NM
, AGY.STD_CONTR_TYP_CD AS AGY_STD_CONTR_TYP
, SUBSTR ( COALESCE ( LGCY.AGY_ID , '0000000000' ) , 8, 3 ) AS AGY_LGCY_ID
, AGY.CONTR_ID AS AGY_CONTR_ID
, AGY.SLLNG_AGMT_STUS_DESC AS AGY_STUS

FROM PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW AGY

LEFT OUTER JOIN PROD_STND_VW.NM_VW NM
ON AGY.CHLD_PRTY_ID = NM.PRTY_ID
AND NM.NM_END_DT = '9999-12-31 00:00:00.000000'
AND NM.NM_TYP_CD = 'FULL'

LEFT OUTER JOIN PROD_USIG_CMN_VW. AGY_CLOSE_MERGE_DATA_VW LGCY
ON AGY.CHLD_BPID = LGCY.AGY_BPID

WHERE AGY.CHLD_SLLNG_AGMT_RLE = 'DST'
AND AGY.SLLNG_AGMT_STUS_CD = '01'

) AGY


LEFT OUTER JOIN
(

SELECT COALESCE ( GA.CHLD_BPID, ' ' ) AS GA_BPID
, COALESCE ( GA.CHLD_PRTY_ID, 0 ) AS GA_PRTY_ID
, CASE WHEN TRIM(NM.LST_NM) = '' AND TRIM(NM.FRST_NM) = '' THEN COALESCE ( NM.FULL_NM , ' ' )
ELSE TRIM ( NM.LST_NM ) || ', ' || TRIM ( NM.FRST_NM )
END AS GA_NM
, COALESCE ( GA.STD_CONTR_TYP_CD, ' ' ) AS GA_STD_CONTR_TYP
, COALESCE ( GA.CONTR_ID, 0 ) AS GA_CONTR_ID
, COALESCE ( GA.PARENT_BPID, ' ' ) AS AGY_BPID
, CAST( GA.REL_STRT_DT AS DATE ) AS GA_AGY_REL_STRT_DT
, CAST( GA.REL_END_DT AS DATE ) AS GA_AGY_REL_END_DT
, GA.SLLNG_AGMT_STUS_DESC AS GA_STUS

FROM PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW GA

LEFT OUTER JOIN PROD_STND_VW.NM_VW NM
ON GA.CHLD_PRTY_ID = NM.PRTY_ID
AND NM.NM_END_DT = '9999-12-31 00:00:00.000000'
AND NM_TYP_CD = 'FULL'

WHERE GA.CHLD_SLLNG_AGMT_RLE = 'GA'
AND GA.SLLNG_AGMT_STUS_CD = '01'

) GA

ON AGY.AGY_BPID = GA.AGY_BPID

;

*** Insert completed. 3885 rows added.
*** Total elapsed time was 8 seconds.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-



/***************** Error Handling ********************************/
.IF ERRORCODE <> 0 THEN .GOTO ERRORS
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
/***************** Error Handling ********************************/




------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------





--- UNIT Table

CREATE VOLATILE TABLE UNIT ,NO FALLBACK ,
NO BEFORE JOURNAL,
NO AFTER JOURNAL,
CHECKSUM = DEFAULT,
DEFAULT MERGEBLOCKRATIO
(
AGY_PRTY_ID BIGINT,
AGY_BPID CHAR(10),
AGY_STUS VARCHAR(20),
UNT_BPID CHAR(10),
UNT_PRTY_ID BIGINT,
UNT_NM VARCHAR(200),
UNT_STD_CONTR_TYP VARCHAR(20),
UNT_CONTR_ID BIGINT,
UNT_AGY_REL_STRT_DT DATE,
UNT_AGY_REL_END_DT DATE,
UNT_STUS VARCHAR(20),
SMBKD_BPID CHAR(10),
SMBKD_PRTY_ID BIGINT,
SMBKD_NM VARCHAR(200),
SMBKD_STD_CONTR_TYP VARCHAR(20),
SMBKD_CONTR_ID BIGINT,
SMBKD_RLE VARCHAR(20),
SMBKD_UNT_REL_STRT_DT DATE,
SMBKD_UNT_REL_END_DT DATE,
SMBKD_STUS VARCHAR(20),
MA_BPID CHAR(10),
MA_PRTY_ID BIGINT,
MA_NM VARCHAR(200),
MA_STD_CONTR_TYP VARCHAR(20),
MA_CONTR_ID BIGINT,
MA_UNT_REL_STRT_DT DATE,
MA_UNT_REL_END_DT DATE,
MA_STUS VARCHAR(20)
)
PRIMARY INDEX (AGY_PRTY_ID)
ON COMMIT PRESERVE ROWS ;

*** Table has been created.
*** Total elapsed time was 2 seconds.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-



/***************** Error Handling ********************************/
.IF ERRORCODE <> 0 THEN .GOTO ERRORS
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
/***************** Error Handling ********************************/


-- Load Units / SMs / BKDs / MAs

INSERT INTO UNIT


SELECT AGY.AGY_PRTY_ID
, AGY.AGY_BPID
, AGY.AGY_STUS
, UNT.UNT_BPID
, UNT.UNT_PRTY_ID
, UNT.UNT_NM
, UNT.UNT_STD_CONTR_TYP
, UNT.UNT_CONTR_ID
, UNT.UNT_AGY_REL_STRT_DT
, UNT.UNT_AGY_REL_END_DT
, UNT.UNT_STUS
, SMBKD.SMBKD_BPID
, SMBKD.SMBKD_PRTY_ID
, SMBKD.SMBKD_NM
, SMBKD.SMBKD_STD_CONTR_TYP
, SMBKD.SMBKD_CONTR_ID
, SMBKD.SMBKD_RLE
, SMBKD.SMBKD_UNT_REL_STRT_DT
, SMBKD.SMBKD_UNT_REL_END_DT
, SMBKD.SMBKD_STUS
, MA.MA_BPID
, MA.MA_PRTY_ID
, MA.MA_NM
, MA.MA_STD_CONTR_TYP
, MA.MA_CONTR_ID
, MA.MA_UNT_REL_STRT_DT
, MA.MA_UNT_REL_END_DT
, MA.MA_STUS

FROM

(

SELECT AGY.CHLD_BPID AS AGY_BPID
, AGY.CHLD_PRTY_ID AS AGY_PRTY_ID
, NM.FULL_NM AS AGY_NM
, AGY.STD_CONTR_TYP_CD AS AGY_STD_CONTR_TYP
, SUBSTR ( COALESCE ( LGCY.AGY_ID , '0000000000' ) , 8, 3 ) AS AGY_LGCY_ID
, AGY.CONTR_ID AS AGY_CONTR_ID
, AGY.SLLNG_AGMT_STUS_DESC AS AGY_STUS

FROM PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW AGY

LEFT OUTER JOIN PROD_STND_VW.NM_VW NM
ON AGY.CHLD_PRTY_ID = NM.PRTY_ID
AND NM.NM_END_DT = '9999-12-31 00:00:00.000000'
AND NM.NM_TYP_CD = 'FULL'

LEFT OUTER JOIN PROD_USIG_CMN_VW. AGY_CLOSE_MERGE_DATA_VW LGCY
ON AGY.CHLD_BPID = LGCY.AGY_BPID

WHERE AGY.CHLD_SLLNG_AGMT_RLE = 'DST'
AND AGY.SLLNG_AGMT_STUS_CD = '01'

) AGY

JOIN

(

SELECT UNT.CHLD_BPID AS UNT_BPID
, UNT.CHLD_PRTY_ID AS UNT_PRTY_ID
, NM.FULL_NM AS UNT_NM
, UNT.STD_CONTR_TYP_CD AS UNT_STD_CONTR_TYP
, UNT.CONTR_ID AS UNT_CONTR_ID
, UNT.PARENT_BPID AS AGY_BPID
, CAST( UNT.REL_STRT_DT AS DATE ) AS UNT_AGY_REL_STRT_DT
, CAST( UNT.REL_END_DT AS DATE ) AS UNT_AGY_REL_END_DT
, UNT.SLLNG_AGMT_STUS_DESC AS UNT_STUS

FROM PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW UNT

LEFT OUTER JOIN PROD_STND_VW.NM_VW NM
ON UNT.CHLD_PRTY_ID = NM.PRTY_ID
AND NM.NM_END_DT = '9999-12-31 00:00:00.000000'
AND NM_TYP_CD = 'FULL'

WHERE UNT.CHLD_SLLNG_AGMT_RLE = 'UNT'
AND UNT.SLLNG_AGMT_STUS_CD = '01'

) UNT

ON AGY.AGY_BPID = UNT.AGY_BPID


LEFT OUTER JOIN

(

SELECT SMBKD.CHLD_BPID AS SMBKD_BPID
, SMBKD.CHLD_PRTY_ID AS SMBKD_PRTY_ID
, CASE WHEN TRIM(NM.LST_NM) = '' AND TRIM(NM.FRST_NM) = '' THEN COALESCE ( NM.FULL_NM , ' ' )
ELSE TRIM ( NM.LST_NM ) || ', ' || TRIM ( NM.FRST_NM )
END AS SMBKD_NM
, SMBKD.STD_CONTR_TYP_CD AS SMBKD_STD_CONTR_TYP
, SMBKD.CONTR_ID AS SMBKD_CONTR_ID
, SMBKD.PARENT_BPID AS UNT_BPID
, SMBKD.CHLD_SLLNG_AGMT_RLE AS SMBKD_RLE
, CAST( SMBKD.REL_STRT_DT AS DATE ) AS SMBKD_UNT_REL_STRT_DT
, CAST( SMBKD.REL_END_DT AS DATE ) AS SMBKD_UNT_REL_END_DT
, SMBKD.SLLNG_AGMT_STUS_DESC AS SMBKD_STUS

FROM PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW SMBKD

LEFT OUTER JOIN PROD_STND_VW.NM_VW NM
ON SMBKD.CHLD_PRTY_ID = NM.PRTY_ID
AND NM.NM_END_DT = '9999-12-31 00:00:00.000000'
AND NM_TYP_CD = 'FULL'

WHERE SMBKD.PARENT_SLLNG_AGMT_RLE = 'UNT'
AND SMBKD.CHLD_SLLNG_AGMT_RLE IN ( 'SM' , 'BKD')
AND SMBKD.SLLNG_AGMT_STUS_CD = '01'

) SMBKD

ON SMBKD.UNT_BPID = UNT.UNT_BPID


LEFT OUTER JOIN

(
SELECT MA.CHLD_BPID AS MA_BPID
, MA.CHLD_PRTY_ID AS MA_PRTY_ID
, CASE WHEN TRIM(NM.LST_NM) = '' AND TRIM(NM.FRST_NM) = '' THEN COALESCE ( NM.FULL_NM , ' ' )
ELSE TRIM ( NM.LST_NM ) || ', ' || TRIM ( NM.FRST_NM )
END AS MA_NM
, MA.STD_CONTR_TYP_CD AS MA_STD_CONTR_TYP
, MA.CONTR_ID AS MA_CONTR_ID
, MA.PARENT_BPID AS UNT_BPID
, CAST( MA.REL_STRT_DT AS DATE ) AS MA_UNT_REL_STRT_DT
, CAST( MA.REL_END_DT AS DATE ) AS MA_UNT_REL_END_DT
, MA.SLLNG_AGMT_STUS_DESC AS MA_STUS

FROM PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW MA

LEFT OUTER JOIN PROD_STND_VW.NM_VW NM
ON MA.CHLD_PRTY_ID = NM.PRTY_ID
AND NM.NM_END_DT = '9999-12-31 00:00:00.000000'
AND NM_TYP_CD = 'FULL'

WHERE MA.PARENT_SLLNG_AGMT_RLE = 'UNT'
AND MA.CHLD_SLLNG_AGMT_RLE = 'MA'
AND MA.SLLNG_AGMT_STUS_CD = '01'

) MA

ON MA.UNT_BPID = UNT.UNT_BPID


;

*** Insert completed. 967 rows added.
*** Total elapsed time was 8 seconds.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-



/***************** Error Handling ********************************/
.IF ERRORCODE <> 0 THEN .GOTO ERRORS
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
/***************** Error Handling ********************************/




------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


-- BROKER DEALER Table


CREATE VOLATILE TABLE BD ,NO FALLBACK ,
NO BEFORE JOURNAL,
NO AFTER JOURNAL,
CHECKSUM = DEFAULT,
DEFAULT MERGEBLOCKRATIO
(
BD_BPID CHAR(10),
BD_PRTY_ID BIGINT,
BD_NM VARCHAR(200),
BD_STD_CONTR_TYP VARCHAR(20),
BD_CONTR_ID BIGINT,
PARENT_BPID CHAR(10),
PARENT_PRTY_ID BIGINT,
BD_PARENT_REL_STRT_DT DATE,
BD_PARENT_REL_END_DT DATE,
BD_STUS VARCHAR(20)
)
PRIMARY INDEX (PARENT_PRTY_ID)
ON COMMIT PRESERVE ROWS ;

*** Table has been created.
*** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-



/***************** Error Handling ********************************/
.IF ERRORCODE <> 0 THEN .GOTO ERRORS
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
/***************** Error Handling ********************************/


-- Load Broker Dealers

INSERT INTO BD


SELECT BD.CHLD_BPID AS BD_BPID
, BD.CHLD_PRTY_ID AS BD_PRTY_ID
, NM.FULL_NM AS BD_NM
, BD.STD_CONTR_TYP_CD AS BD_STD_CONTR_TYP
, BD.CONTR_ID AS BD_CONTR_ID
, BD.PARENT_BPID AS PARENT_BPID
, BD.PARENT_PRTY_ID AS PARENT_PRTY_ID
, CAST( BD.REL_STRT_DT AS DATE ) AS BD_PARENT_REL_STRT_DT
, CAST( BD.REL_END_DT AS DATE ) AS BD_PARENT__REL_END_DT
, BD.SLLNG_AGMT_STUS_DESC AS BD_STUS

FROM PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW BD

LEFT OUTER JOIN PROD_STND_VW.NM_VW NM
ON BD.CHLD_PRTY_ID = NM.PRTY_ID
AND NM.NM_END_DT = '9999-12-31 00:00:00.000000'
AND NM_TYP_CD = 'FULL'

WHERE BD.CHLD_SLLNG_AGMT_RLE = 'BD'
AND BD.SLLNG_AGMT_STUS_CD = '01'

;

*** Insert completed. 86936 rows added.
*** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-



/***************** Error Handling ********************************/
.IF ERRORCODE <> 0 THEN .GOTO ERRORS
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
/***************** Error Handling ********************************/




-- COLLABORATIVE PRACTICE Table



CREATE VOLATILE TABLE CP ,NO FALLBACK ,
NO BEFORE JOURNAL,
NO AFTER JOURNAL,
CHECKSUM = DEFAULT,
DEFAULT MERGEBLOCKRATIO
(
CP_BPID CHAR(10),
CP_PRTY_ID BIGINT,
CP_NM VARCHAR(200),
PRD_BPID CHAR(10),
PRD_PRTY_ID BIGINT,
CP_PRD_REL_STRT_DT DATE,
CP_PRD_REL_END_DT DATE,
CP_STUS VARCHAR(20)
)
PRIMARY INDEX (PRD_PRTY_ID)
ON COMMIT PRESERVE ROWS ;

*** Table has been created.
*** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-


/***************** Error Handling ********************************/
.IF ERRORCODE <> 0 THEN .GOTO ERRORS
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
/***************** Error Handling ********************************/


-- Load Collaborative Practices

INSERT INTO CP


SELECT CP.PARENT_BPID AS CP_BPID
, CP.PARENT_PRTY_ID AS CP_PRTY_ID
, NM.FULL_NM AS CP_NM
, CP.CHLD_BPID AS PRD_BPID
, CP.CHLD_PRTY_ID AS PRD_PRTY_ID
, CAST( CP.REL_STRT_DT AS DATE ) AS CP_PRD_REL_STRT_DT
, CAST( CP.REL_END_DT AS DATE ) AS CP_PRD_REL_END_DT
, CP.SLLNG_AGMT_STUS_DESC AS CP_STUS

FROM PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW CP

LEFT OUTER JOIN PROD_STND_VW.NM_VW NM
ON CP.PARENT_PRTY_ID = NM.PRTY_ID
AND NM.NM_END_DT = '9999-12-31 00:00:00.000000'
AND NM_TYP_CD = 'FULL'

WHERE CP.PARENT_SLLNG_AGMT_RLE = 'CP'
AND CP.CHLD_SLLNG_AGMT_RLE = 'PRD'
AND CP.SLLNG_AGMT_STUS_CD = '01'

;

*** Insert completed. 1570 rows added.
*** Total elapsed time was 3 seconds.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-



/***************** Error Handling ********************************/
.IF ERRORCODE <> 0 THEN .GOTO ERRORS
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
/***************** Error Handling ********************************/



DELETE FROM PROD_STND_TBLS.SALES_HIERARCHY_WRK ;

*** Delete completed. 1792067 rows removed.
*** Total elapsed time was 2 seconds.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-


/***************** Error Handling ********************************/
.IF ERRORCODE <> 0 THEN .GOTO ERRORS
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
/***************** Error Handling ********************************/



-- LEVEL 1


INSERT INTO PROD_STND_TBLS.SALES_HIERARCHY_WRK



SELECT -- AGY
AGY.AGY_BPID
, AGY.AGY_PRTY_ID
, AGY.AGY_NM
, AGY.AGY_STD_CONTR_TYP
, AGY.AGY_LGCY_ID
, AGY.AGY_CONTR_ID
, AGY.AGY_STUS
-- GA
, AGY.GA_BPID
, AGY.GA_PRTY_ID
, AGY.GA_NM
, AGY.GA_STD_CONTR_TYP
, AGY.GA_CONTR_ID
, AGY.GA_AGY_REL_STRT_DT
, AGY.GA_AGY_REL_END_DT
, AGY.GA_STUS
-- UNIT
, UNTPRD.UNT_BPID
, UNTPRD.UNT_PRTY_ID
, UNTPRD.UNT_NM
, UNTPRD.UNT_STD_CONTR_TYP
, UNTPRD.UNT_CONTR_ID
, UNTPRD.UNT_AGY_REL_STRT_DT
, UNTPRD.UNT_AGY_REL_END_DT
, UNTPRD.UNT_STUS
-- SMBKD
, UNTPRD.SMBKD_BPID
, UNTPRD.SMBKD_PRTY_ID
, UNTPRD.SMBKD_NM
, UNTPRD.SMBKD_STD_CONTR_TYP
, UNTPRD.SMBKD_CONTR_ID
, UNTPRD.SMBKD_UNT_REL_STRT_DT
, UNTPRD.SMBKD_UNT_REL_END_DT
, UNTPRD.SMBKD_STUS
-- MA
, UNTPRD.MA_BPID
, UNTPRD.MA_PRTY_ID
, UNTPRD.MA_NM
, UNTPRD.MA_STD_CONTR_TYP
, UNTPRD.MA_CONTR_ID
, UNTPRD.MA_UNT_REL_STRT_DT
, UNTPRD.MA_UNT_REL_END_DT
, UNTPRD.MA_STUS
-- FIRM
, NULL AS FIRM_BPID
, NULL AS FIRM_PRTY_ID
, NULL AS FIRM_NM
, NULL AS FIRM_RLE
, NULL AS FIRM_CONTR_TYP
, NULL AS FIRM_CONTR_ID
, NULL AS FIRM_AGY_REL_STRT_DT
, NULL AS FIRM_AGY_REL_END_DT
, NULL AS FIRM_STUS
-- SUB - ORG
, NULL AS SUBFIRM1_BPID
, NULL AS SUBFIRM1_PRTY_ID
, NULL AS SUBFIRM1_NM
, NULL AS SUBFIRM1_RLE
, NULL AS SUBFIRM1_STD_CONTR_TYP
, NULL AS SUBFIRM1_CONTR_ID
, NULL AS SUBFIRM1_FIRM_REL_STRT_DT
, NULL AS SUBFIRM1_FIRM_REL_END_DT
, NULL AS SUBFIRM1_STUS
-- SUB - ORG 2
, NULL AS SUBFIRM2_BPID
, NULL AS SUBFIRM2_PRTY_ID
, NULL AS SUBFIRM2_NM
, NULL AS SUBFIRM2_RLE
, NULL AS SUBFIRM2_STD_CONTR_TYP
, NULL AS SUBFIRM2_CONTR_ID
, NULL AS SUBFIRM2_SUBFIRM1_REL_STRT_DT
, NULL AS SUBFIRM2_SUBFIRM1_REL_END_DT
, NULL AS SUBFIRM2_STUS
-- BD
, BD.BD_BPID
, BD.BD_PRTY_ID
, BD.BD_NM
, BD.BD_STD_CONTR_TYP
, BD.BD_CONTR_ID
, BD.BD_PARENT_REL_STRT_DT
, BD.BD_PARENT_REL_END_DT
, BD.BD_STUS
-- CP
, CP.CP_BPID
, CP.CP_PRTY_ID
, CP.CP_NM
, NULL AS CP_STD_CONTR_TYP
, NULL AS CP_CONTR_ID
, CP.CP_PRD_REL_STRT_DT
, CP.CP_PRD_REL_END_DT
, CP.CP_STUS
-- PRD
, PRD.PRD_BPID
, PRD.PRD_PRTY_ID
, PRD.PRD_NM
, PRD.PRD_CONTR_ID
, PRD.CHLD_RLE
, PRD.PRD_STD_CONTR_TYP
, PRD.PRD_REL_STRT_DT
, PRD.PRD_REL_END_DT
, PRD.PRD_STUS
, NULL AS PRD_FIRM_REL_STRT_DT
, NULL AS PRD_FIRM_REL_END_DT
, NULL AS PRD_FIRM_STUS
, NULL AS PRD_SUBFIRM1_REL_STRT_DT
, NULL AS PRD_SUBFIRM1_REL_END_DT
, NULL AS PRD_SUBFIRM1_STUS
, NULL AS PRD_SUBFIRM2_REL_STRT_DT
, NULL AS PRD_SUBFIRM2_REL_END_DT
, NULL AS PRD_SUBFIRM2_STUS
, UNTPRD.PRD_UNT_REL_STRT_DT
, UNTPRD.PRD_UNT_REL_END_DT
, UNTPRD.PRD_UNT_STUS
-- OTHER
, 'D' AS PRD_DIRECT_TO_AGY_IND
, UNTPRD.PRD_DIRECT_TO_UNT_IND
, '1' AS HIER_DEPTH
, 'Active' AS HIER_STUS



FROM DST AGY

JOIN

(

SELECT CASE WHEN PRD.CHLD_SLLNG_AGMT_RLE = 'UNT' THEN UNT_PRD.CHLD_BPID ELSE PRD.CHLD_BPID END AS PRD_BPID
, CASE WHEN PRD.CHLD_SLLNG_AGMT_RLE = 'UNT' THEN UNT_PRD.CHLD_PRTY_ID ELSE PRD.CHLD_PRTY_ID END AS PRD_PRTY_ID
, CASE WHEN PRD.CHLD_SLLNG_AGMT_RLE = 'UNT' AND TRIM(NM_UNT_PRD.LST_NM) = '' AND TRIM(NM_UNT_PRD.FRST_NM) = '' THEN COALESCE ( NM_UNT_
PRD.FULL_NM , ' ' )
WHEN PRD.CHLD_SLLNG_AGMT_RLE = 'UNT' THEN TRIM ( NM_UNT_PRD.LST_NM ) || ', ' || TRIM ( NM_UNT_PRD.FRST_NM )
WHEN PRD.CHLD_SLLNG_AGMT_RLE IN ( 'PRD' , 'SA' ) AND TRIM(NM.LST_NM) = '' AND TRIM(NM.FRST_NM) = '' THEN COALESCE ( NM.FULL_NM , '
' )
WHEN PRD.CHLD_SLLNG_AGMT_RLE IN ( 'PRD' , 'SA' ) THEN TRIM ( NM.LST_NM ) || ', ' || TRIM ( NM.FRST_NM )
ELSE NM.FULL_NM
END AS PRD_NM
, CASE WHEN PRD.CHLD_SLLNG_AGMT_RLE = 'UNT' THEN UNT_PRD.STD_CONTR_TYP_CD ELSE PRD.STD_CONTR_TYP_CD END AS PRD_STD_CONTR_TYP
, CASE WHEN PRD.CHLD_SLLNG_AGMT_RLE = 'UNT' THEN UNT_PRD.CONTR_ID ELSE PRD.CONTR_ID END AS PRD_CONTR_ID
, PRD.PARENT_BPID AS AGY_BPID
, PRD.PARENT_PRTY_ID AS AGY_PRTY_ID
, CASE WHEN PRD.CHLD_SLLNG_AGMT_RLE = 'UNT' THEN UNT_PRD.CHLD_SLLNG_AGMT_RLE ELSE PRD.CHLD_SLLNG_AGMT_RLE END AS CHLD_RLE
, CASE WHEN PRD.CHLD_SLLNG_AGMT_RLE = 'UNT' THEN CAST(UNT_PRD.REL_STRT_DT AS DATE) ELSE CAST( PRD.REL_STRT_DT AS DATE ) END AS PRD_REL_STRT
_DT
, CASE WHEN PRD.CHLD_SLLNG_AGMT_RLE = 'UNT' THEN CAST(UNT_PRD.REL_END_DT AS DATE) ELSE CAST( PRD.REL_END_DT AS DATE ) END AS PRD_REL_END_D
T
, CASE WHEN PRD.CHLD_SLLNG_AGMT_RLE = 'UNT' THEN UNT_PRD.SLLNG_AGMT_STUS_DESC ELSE PRD.SLLNG_AGMT_STUS_DESC END AS PRD_STUS

FROM PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW PRD

LEFT OUTER JOIN PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW UNT_PRD
ON PRD.CHLD_PRTY_ID = UNT_PRD.PARENT_PRTY_ID
AND PRD.CHLD_SLLNG_AGMT_RLE = 'UNT'
AND UNT_PRD.CHLD_SLLNG_AGMT_RLE = 'PRD'
AND UNT_PRD.SLLNG_AGMT_STUS_CD = '01'

LEFT OUTER JOIN PROD_STND_VW.NM_VW NM_UNT_PRD
ON UNT_PRD.CHLD_PRTY_ID = NM_UNT_PRD.PRTY_ID
AND NM_UNT_PRD.NM_END_DT = '9999-12-31 00:00:00.000000'
AND NM_UNT_PRD.NM_TYP_CD = 'FULL'

LEFT OUTER JOIN PROD_STND_VW.NM_VW NM
ON PRD.CHLD_PRTY_ID = NM.PRTY_ID
AND NM.NM_END_DT = '9999-12-31 00:00:00.000000'
AND NM.NM_TYP_CD = 'FULL'

WHERE PRD.PARENT_SLLNG_AGMT_RLE = 'DST'
AND PRD.CHLD_SLLNG_AGMT_RLE IN ( 'SA' , 'FA' , 'PRD' , 'TPA' , 'REF' , 'CRP' /*,'UNT'*/ )
AND PRD.SLLNG_AGMT_STUS_CD = '01'


) PRD

ON PRD.AGY_PRTY_ID = AGY.AGY_PRTY_ID



LEFT OUTER JOIN BD BD
ON BD.PARENT_PRTY_ID = PRD.PRD_PRTY_ID


LEFT OUTER JOIN CP CP
ON CP.PRD_PRTY_ID = PRD.PRD_PRTY_ID


LEFT OUTER JOIN

(

SELECT CASE WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'CRP' THEN CRP_PRD.CHLD_BPID
WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'SA' THEN SA_PRD.CHLD_BPID
ELSE UNTPRD.CHLD_BPID END AS UNTPRD_BPID
, CASE WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'CRP' THEN CRP_PRD.CHLD_PRTY_ID
WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'SA' THEN SA_PRD.CHLD_PRTY_ID
ELSE UNTPRD.CHLD_PRTY_ID END AS UNTPRD_PRTY_ID
, CASE WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'CRP' THEN CRP_PRD.STD_CONTR_TYP_CD
WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'SA' THEN SA_PRD.STD_CONTR_TYP_CD
ELSE UNTPRD.STD_CONTR_TYP_CD END AS UNTPRD_STD_CONTR_TYP
, CASE WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'CRP' THEN CRP_PRD.CONTR_ID
WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'SA' THEN SA_PRD.CONTR_ID
ELSE UNTPRD.CONTR_ID END AS UNTPRD_CONTR_ID
, CASE WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'CRP' THEN CRP_PRD.PARENT_BPID
WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'SA' THEN SA_PRD.PARENT_BPID
ELSE UNTPRD.PARENT_BPID END AS UNT_BPID_2
, CAST( UNTPRD.REL_STRT_DT AS DATE ) AS PRD_UNT_REL_STRT_DT
, CASE WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'CRP' AND CAST(CRP_PRD.REL_END_DT AS DATE) < CAST( UNTPRD.REL_END_DT AS DATE ) THEN CAST(CRP_PRD
.REL_END_DT AS DATE)
WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'SA' AND CAST(SA_PRD.REL_END_DT AS DATE) < CAST( UNTPRD.REL_END_DT AS DATE ) THEN CAST(SA_PRD.REL_EN
D_DT AS DATE)
ELSE CAST( UNTPRD.REL_END_DT AS DATE ) END AS PRD_UNT_REL_END_DT
, CASE WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'CRP' THEN CRP_PRD.SLLNG_AGMT_STUS_DESC
WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'SA' THEN SA_PRD.SLLNG_AGMT_STUS_DESC
ELSE UNTPRD.SLLNG_AGMT_STUS_DESC
END PRD_UNT_STUS
, COALESCE (UNT.AGY_PRTY_ID, 0) AS AGY_PRTY_ID
, UNT.UNT_BPID AS UNT_BPID
, UNT.UNT_PRTY_ID AS UNT_PRTY_ID
, UNT.UNT_NM AS UNT_NM
, UNT.UNT_STD_CONTR_TYP AS UNT_STD_CONTR_TYP
, UNT.UNT_CONTR_ID AS UNT_CONTR_ID
, UNT.UNT_AGY_REL_STRT_DT
, UNT.UNT_AGY_REL_END_DT
, UNT.UNT_STUS
, UNT.SMBKD_BPID AS SMBKD_BPID
, UNT.SMBKD_PRTY_ID AS SMBKD_PRTY_ID
, UNT.SMBKD_NM AS SMBKD_NM
, UNT.SMBKD_STD_CONTR_TYP AS SMBKD_STD_CONTR_TYP
, UNT.SMBKD_CONTR_ID AS SMBKD_CONTR_ID
, UNT.SMBKD_UNT_REL_STRT_DT
, UNT.SMBKD_UNT_REL_END_DT
, UNT.SMBKD_STUS
, UNT.MA_BPID AS MA_BPID
, UNT.MA_PRTY_ID AS MA_PRTY_ID
, UNT.MA_NM AS MA_NM
, UNT.MA_STD_CONTR_TYP AS MA_STD_CONTR_TYP
, UNT.MA_CONTR_ID AS MA_CONTR_ID
, UNT.MA_UNT_REL_STRT_DT
, UNT.MA_UNT_REL_END_DT
, UNT.MA_STUS
, CRP_PRD.CHLD_BPID
, UNTPRD.CHLD_SLLNG_AGMT_RLE
, 'I' AS PRD_DIRECT_TO_UNT_IND

FROM PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW UNTPRD

LEFT OUTER JOIN PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW CRP_PRD
ON UNTPRD.CHLD_PRTY_ID = CRP_PRD.PARENT_PRTY_ID
AND UNTPRD.CHLD_SLLNG_AGMT_RLE = 'CRP'
AND CRP_PRD.CHLD_SLLNG_AGMT_RLE = 'PRD'
AND CRP_PRD.SLLNG_AGMT_STUS_CD = '01'

LEFT OUTER JOIN PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW SA_PRD
ON UNTPRD.CHLD_PRTY_ID = SA_PRD.PARENT_PRTY_ID
AND UNTPRD.CHLD_SLLNG_AGMT_RLE = 'SA'
AND SA_PRD.CHLD_SLLNG_AGMT_RLE = 'PRD'
AND SA_PRD.SLLNG_AGMT_STUS_CD = '01'

LEFT OUTER JOIN UNIT UNT
ON UNTPRD.PARENT_PRTY_ID = UNT.UNT_PRTY_ID


WHERE UNTPRD.PARENT_SLLNG_AGMT_RLE = 'UNT'
AND UNTPRD.CHLD_SLLNG_AGMT_RLE IN ( 'CRP' , 'SA' ) -- ( 'CRP' , 'SM' , 'BKD' , 'MA' , 'SA' , 'FA' , 'PRD' )
AND UNTPRD.SLLNG_AGMT_STUS_CD = '01'


UNION ALL


SELECT UNTPRD.CHLD_BPID AS UNTPRD_BPID
, UNTPRD.CHLD_PRTY_ID AS UNTPRD_PRTY_ID
, UNTPRD.STD_CONTR_TYP_CD AS UNTPRD_STD_CONTR_TYP
, UNTPRD.CONTR_ID AS UNTPRD_CONTR_ID
, UNTPRD.PARENT_BPID AS UNT_BPID_2
, CAST( UNTPRD.REL_STRT_DT AS DATE ) AS PRD_UNT_REL_STRT_DT
, CAST( UNTPRD.REL_END_DT AS DATE ) AS PRD_UNT_REL_END_DT
, UNTPRD.SLLNG_AGMT_STUS_DESC AS PRD_UNT_STUS
, COALESCE (UNT.AGY_PRTY_ID, 0) AS AGY_PRTY_ID
, UNT.UNT_BPID AS UNT_BPID
, UNT.UNT_PRTY_ID AS UNT_PRTY_ID
, UNT.UNT_NM AS UNT_NM
, UNT.UNT_STD_CONTR_TYP AS UNT_STD_CONTR_TYP
, UNT.UNT_CONTR_ID AS UNT_CONTR_ID
, UNT.UNT_AGY_REL_STRT_DT
, UNT.UNT_AGY_REL_END_DT
, UNT.UNT_STUS
, UNT.SMBKD_BPID AS SMBKD_BPID
, UNT.SMBKD_PRTY_ID AS SMBKD_PRTY_ID
, UNT.SMBKD_NM AS SMBKD_NM
, UNT.SMBKD_STD_CONTR_TYP AS SMBKD_STD_CONTR_TYP
, UNT.SMBKD_CONTR_ID AS SMBKD_CONTR_ID
, UNT.SMBKD_UNT_REL_STRT_DT
, UNT.SMBKD_UNT_REL_END_DT
, UNT.SMBKD_STUS
, UNT.MA_BPID AS MA_BPID
, UNT.MA_PRTY_ID AS MA_PRTY_ID
, UNT.MA_NM AS MA_NM
, UNT.MA_STD_CONTR_TYP AS MA_STD_CONTR_TYP
, UNT.MA_CONTR_ID AS MA_CONTR_ID
, UNT.MA_UNT_REL_STRT_DT
, UNT.MA_UNT_REL_END_DT
, UNT.MA_STUS
, UNTPRD.CHLD_BPID
, UNTPRD.CHLD_SLLNG_AGMT_RLE
, 'D' AS PRD_DIRECT_TO_UNT_IND

FROM PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW UNTPRD


LEFT OUTER JOIN UNIT UNT
ON UNTPRD.PARENT_PRTY_ID = UNT.UNT_PRTY_ID


WHERE UNTPRD.PARENT_SLLNG_AGMT_RLE = 'UNT'
AND UNTPRD.CHLD_SLLNG_AGMT_RLE IN ( 'CRP' , 'SM' , 'BKD' , 'MA' , 'SA' , 'FA' , 'PRD' )
AND UNTPRD.SLLNG_AGMT_STUS_CD = '01'


) UNTPRD

ON UNTPRD.UNTPRD_PRTY_ID = PRD.PRD_PRTY_ID
AND UNTPRD.AGY_PRTY_ID = PRD.AGY_PRTY_ID




;

*** Insert completed. 228726 rows added.
*** Total elapsed time was 7 seconds.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-



/***************** Error Handling ********************************/
.IF ERRORCODE <> 0 THEN .GOTO ERRORS
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
/***************** Error Handling ********************************/




-- LEVEL 2



INSERT INTO PROD_STND_TBLS.SALES_HIERARCHY_WRK




SELECT -- AGY
AGY.AGY_BPID
, AGY.AGY_PRTY_ID
, AGY.AGY_NM
, AGY.AGY_STD_CONTR_TYP
, AGY.AGY_LGCY_ID
, AGY.AGY_CONTR_ID
, AGY.AGY_STUS
-- GA
, AGY.GA_BPID
, AGY.GA_PRTY_ID
, AGY.GA_NM
, AGY.GA_STD_CONTR_TYP
, AGY.GA_CONTR_ID
, AGY.GA_AGY_REL_STRT_DT
, AGY.GA_AGY_REL_END_DT
, AGY.GA_STUS
-- UNIT
, UNTPRD.UNT_BPID
, UNTPRD.UNT_PRTY_ID
, UNTPRD.UNT_NM
, UNTPRD.UNT_STD_CONTR_TYP
, UNTPRD.UNT_CONTR_ID
, UNTPRD.UNT_AGY_REL_STRT_DT
, UNTPRD.UNT_AGY_REL_END_DT
, UNTPRD.UNT_STUS
-- SMBKD
, UNTPRD.SMBKD_BPID
, UNTPRD.SMBKD_PRTY_ID
, UNTPRD.SMBKD_NM
, UNTPRD.SMBKD_STD_CONTR_TYP
, UNTPRD.SMBKD_CONTR_ID
, UNTPRD.SMBKD_UNT_REL_STRT_DT
, UNTPRD.SMBKD_UNT_REL_END_DT
, UNTPRD.SMBKD_STUS
-- MA
, UNTPRD.MA_BPID
, UNTPRD.MA_PRTY_ID
, UNTPRD.MA_NM
, UNTPRD.MA_STD_CONTR_TYP
, UNTPRD.MA_CONTR_ID
, UNTPRD.MA_UNT_REL_STRT_DT
, UNTPRD.MA_UNT_REL_END_DT
, UNTPRD.MA_STUS
-- FIRM
, FIRM.FIRM_BPID
, FIRM.FIRM_PRTY_ID
, FIRM.FIRM_NM
, FIRM.FIRM_RLE
, FIRM.FIRM_STD_CONTR_TYP
, FIRM.FIRM_CONTR_ID
, FIRM.FIRM_AGY_REL_STRT_DT
, FIRM.FIRM_AGY_REL_END_DT
, FIRM.FIRM_STUS
-- SUB - ORG
, NULL AS SUBFIRM1_BPID
, NULL AS SUBFIRM1_PRTY_ID
, NULL AS SUBFIRM1_NM
, NULL AS SUBFIRM1_RLE
, NULL AS SUBFIRM1_STD_CONTR_TYP
, NULL AS SUBFIRM1_CONTR_ID
, NULL AS SUBFIRM1_FIRM_REL_STRT_DT
, NULL AS SUBFIRM1_FIRM_REL_END_DT
, NULL AS SUBFIRM1_STUS
-- SUB - ORG 2
, NULL AS SUBFIRM2_BPID
, NULL AS SUBFIRM2_PRTY_ID
, NULL AS SUBFIRM2_NM
, NULL AS SUBFIRM2_RLE
, NULL AS SUBFIRM2_STD_CONTR_TYP
, NULL AS SUBFIRM2_CONTR_ID
, NULL AS SUBFIRM2_SUBFIRM1_REL_STRT_DT
, NULL AS SUBFIRM2_SUBFIRM1_REL_END_DT
, NULL AS SUBFIRM2_STUS
-- BD
, BD.BD_BPID
, BD.BD_PRTY_ID
, BD.BD_NM
, BD.BD_STD_CONTR_TYP
, BD.BD_CONTR_ID
, BD.BD_PARENT_REL_STRT_DT
, BD.BD_PARENT_REL_END_DT
, BD.BD_STUS
-- CP
, NULL AS CP_BPID
, NULL AS CP_PRTY_ID
, NULL AS CP_NM
, NULL AS CP_STD_CONTR_TYP
, NULL AS CP_CONTR_ID
, NULL AS CP_PRD_REL_STRT_DT
, NULL AS CP_PRD_REL_END_DT
, NULL AS CP_STUS
-- PRD
, SUBPRD.PRD_BPID
, SUBPRD.PRD_PRTY_ID
, SUBPRD.PRD_NM
, SUBPRD.PRD_CONTR_ID
, SUBPRD.CHLD_RLE
, SUBPRD.PRD_STD_CONTR_TYP
, SUBPRD.PRD_FIRM_REL_STRT_DT AS PRD_REL_STRT_DT
, SUBPRD.PRD_FIRM_REL_END_DT AS PRD_REL_END_DT
, SUBPRD.PRD_FIRM_STUS AS PRD_STUS
, SUBPRD.PRD_FIRM_REL_STRT_DT
, SUBPRD.PRD_FIRM_REL_END_DT
, SUBPRD.PRD_FIRM_STUS
, NULL AS PRD_SUBFIRM1_REL_STRT_DT
, NULL AS PRD_SUBFIRM1_REL_END_DT
, NULL AS PRD_SUBFIRM1_STUS
, NULL AS PRD_SUBFIRM2_REL_STRT_DT
, NULL AS PRD_SUBFIRM2_REL_END_DT
, NULL AS PRD_SUBFIRM2_STUS
, UNTPRD.PRD_UNT_REL_STRT_DT
, UNTPRD.PRD_UNT_REL_END_DT
, UNTPRD.PRD_UNT_STUS
-- OTHER
, 'I' AS PRD_DIRECT_TO_AGY_IND
, UNTPRD.PRD_DIRECT_TO_UNT_IND
, '2' AS HIER_DEPTH
, 'Active' AS HIER_STUS

FROM DST AGY

JOIN

(

SELECT FIRM.CHLD_BPID AS FIRM_BPID
, FIRM.CHLD_PRTY_ID AS FIRM_PRTY_ID
, NM.FULL_NM AS FIRM_NM
, FIRM.STD_CONTR_TYP_CD AS FIRM_STD_CONTR_TYP
, FIRM.CONTR_ID AS FIRM_CONTR_ID
, FIRM.PARENT_BPID AS AGY_BPID
, FIRM.PARENT_PRTY_ID AS AGY_PRTY_ID
, FIRM.CHLD_SLLNG_AGMT_RLE AS FIRM_RLE
, CAST( FIRM.REL_STRT_DT AS DATE ) AS FIRM_AGY_REL_STRT_DT
, CAST( FIRM.REL_END_DT AS DATE ) AS FIRM_AGY_REL_END_DT
, FIRM.SLLNG_AGMT_STUS_DESC AS FIRM_STUS

FROM PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW FIRM

LEFT OUTER JOIN PROD_STND_VW.NM_VW NM
ON FIRM.CHLD_PRTY_ID = NM.PRTY_ID
AND NM.NM_END_DT = '9999-12-31 00:00:00.000000'
AND NM_TYP_CD = 'FULL'

WHERE FIRM.PARENT_SLLNG_AGMT_RLE = 'DST'
AND FIRM.CHLD_SLLNG_AGMT_RLE IN ( 'OFF' , 'RTF' , 'CRP' , 'SA' )
AND FIRM.SLLNG_AGMT_STUS_CD = '01'

) FIRM

ON FIRM.AGY_PRTY_ID = AGY.AGY_PRTY_ID


JOIN

(

SELECT SUBPRD.CHLD_BPID AS PRD_BPID
, SUBPRD.CHLD_PRTY_ID AS PRD_PRTY_ID
, CASE WHEN SUBPRD.CHLD_SLLNG_AGMT_RLE IN ( 'PRD' , 'SA' ) AND TRIM(NM.LST_NM) = '' AND TRIM(NM.FRST_NM) = '' THEN COALESCE ( NM.FULL_
NM , ' ' )
WHEN SUBPRD.CHLD_SLLNG_AGMT_RLE IN ( 'PRD' , 'SA' ) THEN TRIM ( NM.LST_NM ) || ', ' || TRIM ( NM.FRST_NM )
ELSE NM.FULL_NM
END AS PRD_NM
, SUBPRD.STD_CONTR_TYP_CD AS PRD_STD_CONTR_TYP
, SUBPRD.CONTR_ID AS PRD_CONTR_ID
, SUBPRD.PARENT_BPID AS FIRM_BPID
, SUBPRD.PARENT_SLLNG_AGMT_RLE AS FIRM_RLE
, SUBPRD.PARENT_PRTY_ID AS FIRM_PRTY_ID
, SUBPRD.CHLD_SLLNG_AGMT_RLE AS CHLD_RLE
, CAST( SUBPRD.REL_STRT_DT AS DATE ) AS PRD_FIRM_REL_STRT_DT
, CAST( SUBPRD.REL_END_DT AS DATE ) AS PRD_FIRM_REL_END_DT
, SUBPRD.SLLNG_AGMT_STUS_DESC AS PRD_FIRM_STUS


FROM PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW SUBPRD

LEFT OUTER JOIN PROD_STND_VW.NM_VW NM
ON SUBPRD.CHLD_PRTY_ID = NM.PRTY_ID
AND NM.NM_END_DT = '9999-12-31 00:00:00.000000'
AND NM_TYP_CD = 'FULL'

WHERE SUBPRD.PARENT_SLLNG_AGMT_RLE IN ( 'OFF' , 'RTF' , 'CRP' , 'SA' )
AND SUBPRD.CHLD_SLLNG_AGMT_RLE IN ( 'PRD' , 'FA' , 'TPA' , 'REF' )
AND SUBPRD.SLLNG_AGMT_STUS_CD = '01'

) SUBPRD

ON FIRM.FIRM_PRTY_ID = SUBPRD.FIRM_PRTY_ID
AND FIRM.FIRM_RLE = SUBPRD.FIRM_RLE



LEFT OUTER JOIN BD BD
ON BD.PARENT_PRTY_ID = SUBPRD.PRD_PRTY_ID



LEFT OUTER JOIN

(

SELECT CASE WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'CRP' THEN CRP_PRD.CHLD_BPID
WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'SA' THEN SA_PRD.CHLD_BPID
ELSE UNTPRD.CHLD_BPID END AS UNTPRD_BPID
, CASE WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'CRP' THEN CRP_PRD.CHLD_PRTY_ID
WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'SA' THEN SA_PRD.CHLD_PRTY_ID
ELSE UNTPRD.CHLD_PRTY_ID END AS UNTPRD_PRTY_ID
, CASE WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'CRP' THEN CRP_PRD.STD_CONTR_TYP_CD
WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'SA' THEN SA_PRD.STD_CONTR_TYP_CD
ELSE UNTPRD.STD_CONTR_TYP_CD END AS UNTPRD_STD_CONTR_TYP
, CASE WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'CRP' THEN CRP_PRD.CONTR_ID
WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'SA' THEN SA_PRD.CONTR_ID
ELSE UNTPRD.CONTR_ID END AS UNTPRD_CONTR_ID
, CASE WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'CRP' THEN CRP_PRD.PARENT_BPID
WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'SA' THEN SA_PRD.PARENT_BPID
ELSE UNTPRD.PARENT_BPID END AS UNT_BPID_2
, CAST( UNTPRD.REL_STRT_DT AS DATE ) AS PRD_UNT_REL_STRT_DT
, CASE WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'CRP' AND CAST(CRP_PRD.REL_END_DT AS DATE) < CAST( UNTPRD.REL_END_DT AS DATE ) THEN CAST(CRP_PRD
.REL_END_DT AS DATE)
WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'SA' AND CAST(SA_PRD.REL_END_DT AS DATE) < CAST( UNTPRD.REL_END_DT AS DATE ) THEN CAST(SA_PRD.REL_EN
D_DT AS DATE)
ELSE CAST( UNTPRD.REL_END_DT AS DATE ) END AS PRD_UNT_REL_END_DT
, CASE WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'CRP' THEN CRP_PRD.SLLNG_AGMT_STUS_DESC
WHEN UNTPRD.CHLD_SLLNG_AGMT_RLE = 'SA' THEN SA_PRD.SLLNG_AGMT_STUS_DESC
ELSE UNTPRD.SLLNG_AGMT_STUS_DESC
END PRD_UNT_STUS
, COALESCE (UNT.AGY_PRTY_ID, 0) AS AGY_PRTY_ID
, UNT.UNT_BPID AS UNT_BPID
, UNT.UNT_PRTY_ID AS UNT_PRTY_ID
, UNT.UNT_NM AS UNT_NM
, UNT.UNT_STD_CONTR_TYP AS UNT_STD_CONTR_TYP
, UNT.UNT_CONTR_ID AS UNT_CONTR_ID
, UNT.UNT_AGY_REL_STRT_DT
, UNT.UNT_AGY_REL_END_DT
, UNT.UNT_STUS
, UNT.SMBKD_BPID AS SMBKD_BPID
, UNT.SMBKD_PRTY_ID AS SMBKD_PRTY_ID
, UNT.SMBKD_NM AS SMBKD_NM
, UNT.SMBKD_STD_CONTR_TYP AS SMBKD_STD_CONTR_TYP
, UNT.SMBKD_CONTR_ID AS SMBKD_CONTR_ID
, UNT.SMBKD_UNT_REL_STRT_DT
, UNT.SMBKD_UNT_REL_END_DT
, UNT.SMBKD_STUS
, UNT.MA_BPID AS MA_BPID
, UNT.MA_PRTY_ID AS MA_PRTY_ID
, UNT.MA_NM AS MA_NM
, UNT.MA_STD_CONTR_TYP AS MA_STD_CONTR_TYP
, UNT.MA_CONTR_ID AS MA_CONTR_ID
, UNT.MA_UNT_REL_STRT_DT
, UNT.MA_UNT_REL_END_DT
, UNT.MA_STUS
, CRP_PRD.CHLD_BPID
, UNTPRD.CHLD_SLLNG_AGMT_RLE
, 'I' AS PRD_DIRECT_TO_UNT_IND

FROM PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW UNTPRD

LEFT OUTER JOIN PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW CRP_PRD
ON UNTPRD.CHLD_PRTY_ID = CRP_PRD.PARENT_PRTY_ID
AND UNTPRD.CHLD_SLLNG_AGMT_RLE = 'CRP'
AND CRP_PRD.CHLD_SLLNG_AGMT_RLE = 'PRD'
AND CRP_PRD.SLLNG_AGMT_STUS_CD = '01'

LEFT OUTER JOIN PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW SA_PRD
ON UNTPRD.CHLD_PRTY_ID = SA_PRD.PARENT_PRTY_ID
AND UNTPRD.CHLD_SLLNG_AGMT_RLE = 'SA'
AND SA_PRD.CHLD_SLLNG_AGMT_RLE = 'PRD'
AND SA_PRD.SLLNG_AGMT_STUS_CD = '01'

LEFT OUTER JOIN UNIT UNT
ON UNTPRD.PARENT_PRTY_ID = UNT.UNT_PRTY_ID


WHERE UNTPRD.PARENT_SLLNG_AGMT_RLE = 'UNT'
AND UNTPRD.CHLD_SLLNG_AGMT_RLE IN ( 'CRP' , 'SA' ) -- ( 'CRP' , 'SM' , 'BKD' , 'MA' , 'SA' , 'FA' , 'PRD' )
AND UNTPRD.SLLNG_AGMT_STUS_CD = '01'


UNION ALL


SELECT UNTPRD.CHLD_BPID AS UNTPRD_BPID
, UNTPRD.CHLD_PRTY_ID AS UNTPRD_PRTY_ID
, UNTPRD.STD_CONTR_TYP_CD AS UNTPRD_STD_CONTR_TYP
, UNTPRD.CONTR_ID AS UNTPRD_CONTR_ID
, UNTPRD.PARENT_BPID AS UNT_BPID_2
, CAST( UNTPRD.REL_STRT_DT AS DATE ) AS PRD_UNT_REL_STRT_DT
, CAST( UNTPRD.REL_END_DT AS DATE ) AS PRD_UNT_REL_END_DT
, UNTPRD.SLLNG_AGMT_STUS_DESC AS PRD_UNT_STUS
, COALESCE (UNT.AGY_PRTY_ID, 0) AS AGY_PRTY_ID
, UNT.UNT_BPID AS UNT_BPID
, UNT.UNT_PRTY_ID AS UNT_PRTY_ID
, UNT.UNT_NM AS UNT_NM
, UNT.UNT_STD_CONTR_TYP AS UNT_STD_CONTR_TYP
, UNT.UNT_CONTR_ID AS UNT_CONTR_ID
, UNT.UNT_AGY_REL_STRT_DT
, UNT.UNT_AGY_REL_END_DT
, UNT.UNT_STUS
, UNT.SMBKD_BPID AS SMBKD_BPID
, UNT.SMBKD_PRTY_ID AS SMBKD_PRTY_ID
, UNT.SMBKD_NM AS SMBKD_NM
, UNT.SMBKD_STD_CONTR_TYP AS SMBKD_STD_CONTR_TYP
, UNT.SMBKD_CONTR_ID AS SMBKD_CONTR_ID
, UNT.SMBKD_UNT_REL_STRT_DT
, UNT.SMBKD_UNT_REL_END_DT
, UNT.SMBKD_STUS
, UNT.MA_BPID AS MA_BPID
, UNT.MA_PRTY_ID AS MA_PRTY_ID
, UNT.MA_NM AS MA_NM
, UNT.MA_STD_CONTR_TYP AS MA_STD_CONTR_TYP
, UNT.MA_CONTR_ID AS MA_CONTR_ID
, UNT.MA_UNT_REL_STRT_DT
, UNT.MA_UNT_REL_END_DT
, UNT.MA_STUS
, UNTPRD.CHLD_BPID
, UNTPRD.CHLD_SLLNG_AGMT_RLE
, 'I' AS PRD_DIRECT_TO_UNT_IND

FROM PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW UNTPRD


LEFT OUTER JOIN UNIT UNT
ON UNTPRD.PARENT_PRTY_ID = UNT.UNT_PRTY_ID


WHERE UNTPRD.PARENT_SLLNG_AGMT_RLE = 'UNT'
AND UNTPRD.CHLD_SLLNG_AGMT_RLE IN ( 'CRP' , 'SM' , 'BKD' , 'MA' , 'SA' , 'FA' , 'PRD' )
AND UNTPRD.SLLNG_AGMT_STUS_CD = '01'

) UNTPRD

ON UNTPRD.UNTPRD_PRTY_ID = SUBPRD.PRD_PRTY_ID --FIRM.FIRM_PRTY_ID
AND UNTPRD.AGY_PRTY_ID = FIRM.AGY_PRTY_ID



;

*** Insert completed. 1557849 rows added.
*** Total elapsed time was 24 seconds.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-



/***************** Error Handling ********************************/
.IF ERRORCODE <> 0 THEN .GOTO ERRORS
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
/***************** Error Handling ********************************/


-- LEVEL 3


INSERT INTO PROD_STND_TBLS.SALES_HIERARCHY_WRK





SELECT -- AGY
AGY.AGY_BPID
, AGY.AGY_PRTY_ID
, AGY.AGY_NM
, AGY.AGY_STD_CONTR_TYP
, AGY.AGY_LGCY_ID
, AGY.AGY_CONTR_ID
, AGY.AGY_STUS
-- GA
, AGY.GA_BPID
, AGY.GA_PRTY_ID
, AGY.GA_NM
, AGY.GA_STD_CONTR_TYP
, AGY.GA_CONTR_ID
, AGY.GA_AGY_REL_STRT_DT
, AGY.GA_AGY_REL_END_DT
, AGY.GA_STUS
-- UNIT
, UNTPRD.UNT_BPID
, UNTPRD.UNT_PRTY_ID
, UNTPRD.UNT_NM
, UNTPRD.UNT_STD_CONTR_TYP
, UNTPRD.UNT_CONTR_ID
, UNTPRD.UNT_AGY_REL_STRT_DT
, UNTPRD.UNT_AGY_REL_END_DT
, UNTPRD.UNT_STUS
-- SMBKD
, UNTPRD.SMBKD_BPID
, UNTPRD.SMBKD_PRTY_ID
, UNTPRD.SMBKD_NM
, UNTPRD.SMBKD_STD_CONTR_TYP
, UNTPRD.SMBKD_CONTR_ID
, UNTPRD.SMBKD_UNT_REL_STRT_DT
, UNTPRD.SMBKD_UNT_REL_END_DT
, UNTPRD.SMBKD_STUS
-- MA
, UNTPRD.MA_BPID
, UNTPRD.MA_PRTY_ID
, UNTPRD.MA_NM
, UNTPRD.MA_STD_CONTR_TYP
, UNTPRD.MA_CONTR_ID
, UNTPRD.MA_UNT_REL_STRT_DT
, UNTPRD.MA_UNT_REL_END_DT
, UNTPRD.MA_STUS
-- FIRM
, FIRM.FIRM_BPID
, FIRM.FIRM_PRTY_ID
, FIRM.FIRM_NM
, FIRM.FIRM_RLE
, FIRM.FIRM_STD_CONTR_TYP
, FIRM.FIRM_CONTR_ID
, FIRM.FIRM_AGY_REL_STRT_DT
, FIRM.FIRM_AGY_REL_END_DT
, FIRM.FIRM_STUS
-- SUB - ORG
, SUBFIRM1.SUBFIRM1_BPID
, SUBFIRM1.SUBFIRM1_PRTY_ID
, SUBFIRM1.SUBFIRM1_NM
, SUBFIRM1.SUBFIRM1_RLE
, SUBFIRM1.SUBFIRM1_STD_CONTR_TYP
, SUBFIRM1.SUBFIRM1_CONTR_ID
, SUBFIRM1.SUBFIRM1_FIRM_REL_STRT_DT
, SUBFIRM1.SUBFIRM1_FIRM_REL_END_DT
, SUBFIRM1.SUBFIRM1_STUS
-- SUB - ORG 2
, NULL AS SUBFIRM2_BPID
, NULL AS SUBFIRM2_PRTY_ID
, NULL AS SUBFIRM2_NM
, NULL AS SUBFIRM2_RLE
, NULL AS SUBFIRM2_STD_CONTR_TYP
, NULL AS SUBFIRM2_CONTR_ID
, NULL AS SUBFIRM2_SUBFIRM1_REL_STRT_DT
, NULL AS SUBFIRM2_SUBFIRM1_REL_END_DT
, NULL AS SUBFIRM2_STUS
-- BD
, BD.BD_BPID
, BD.BD_PRTY_ID
, BD.BD_NM
, BD.BD_STD_CONTR_TYP
, BD.BD_CONTR_ID
, BD.BD_PARENT_REL_STRT_DT
, BD.BD_PARENT_REL_END_DT
, BD.BD_STUS
-- CP
, NULL AS CP_BPID
, NULL AS CP_PRTY_ID
, NULL AS CP_NM
, NULL AS CP_STD_CONTR_TYP
, NULL AS CP_CONTR_ID
, NULL AS CP_PRD_REL_STRT_DT
, NULL AS CP_PRD_REL_END_DT
, NULL AS CP_STUS
-- PRD
, SUBPRD.PRD_BPID
, SUBPRD.PRD_PRTY_ID
, SUBPRD.PRD_NM
, SUBPRD.PRD_CONTR_ID
, SUBPRD.CHLD_RLE
, SUBPRD.PRD_STD_CONTR_TYP
, SUBPRD.PRD_SUBFIRM1_REL_STRT_DT AS PRD_REL_STRT_DT
, SUBPRD.PRD_SUBFIRM1_REL_END_DT AS PRD_REL_END_DT
, SUBPRD.PRD_SUBFIRM1_STUS AS PRD_STUS
, NULL AS PRD_FIRM_REL_STRT_DT
, NULL AS PRD_FIRM_REL_END_DT
, NULL AS PRD_FIRM_STUS
, SUBPRD.PRD_SUBFIRM1_REL_STRT_DT
, SUBPRD.PRD_SUBFIRM1_REL_END_DT
, SUBPRD.PRD_SUBFIRM1_STUS
, NULL AS PRD_SUBFIRM2_REL_STRT_DT
, NULL AS PRD_SUBFIRM2_REL_END_DT
, NULL AS PRD_SUBFIRM2_STUS
, UNTPRD.PRD_UNT_REL_STRT_DT
, UNTPRD.PRD_UNT_REL_END_DT
, UNTPRD.PRD_UNT_STUS
-- OTHER
, 'I' AS PRD_DIRECT_TO_AGY_IND
, UNTPRD.PRD_DIRECT_TO_UNT_IND
, '3' AS HIER_DEPTH
, 'Active' AS HIER_STUS


FROM DST AGY

JOIN

(

SELECT FIRM.CHLD_BPID AS FIRM_BPID
, FIRM.CHLD_PRTY_ID AS FIRM_PRTY_ID
, NM.FULL_NM AS FIRM_NM
, FIRM.STD_CONTR_TYP_CD AS FIRM_STD_CONTR_TYP
, FIRM.CONTR_ID AS FIRM_CONTR_ID
, FIRM.PARENT_BPID AS AGY_BPID
, FIRM.PARENT_PRTY_ID AS AGY_PRTY_ID
, FIRM.CHLD_SLLNG_AGMT_RLE AS FIRM_RLE
, CAST( FIRM.REL_STRT_DT AS DATE ) AS FIRM_AGY_REL_STRT_DT
, CAST( FIRM.REL_END_DT AS DATE ) AS FIRM_AGY_REL_END_DT
, FIRM.SLLNG_AGMT_STUS_DESC AS FIRM_STUS

FROM PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW FIRM

LEFT OUTER JOIN PROD_STND_VW.NM_VW NM
ON FIRM.CHLD_PRTY_ID = NM.PRTY_ID
AND NM.NM_END_DT = '9999-12-31 00:00:00.000000'
AND NM_TYP_CD = 'FULL'

WHERE FIRM.PARENT_SLLNG_AGMT_RLE = 'DST'
AND FIRM.CHLD_SLLNG_AGMT_RLE IN ( 'RTF', 'CRP','OFF')
AND FIRM.SLLNG_AGMT_STUS_CD = '01'

) FIRM

ON FIRM.AGY_PRTY_ID = AGY.AGY_PRTY_ID


JOIN

(

SELECT SUBFIRM1.CHLD_BPID AS SUBFIRM1_BPID
, SUBFIRM1.CHLD_PRTY_ID AS SUBFIRM1_PRTY_ID
, NM.FULL_NM AS SUBFIRM1_NM
, SUBFIRM1.STD_CONTR_TYP_CD AS SUBFIRM1_STD_CONTR_TYP
, SUBFIRM1.CONTR_ID AS SUBFIRM1_CONTR_ID
, SUBFIRM1.PARENT_BPID AS FIRM_BPID
, SUBFIRM1.PARENT_PRTY_ID AS FIRM_PRTY_ID
, SUBFIRM1.PARENT_SLLNG_AGMT_RLE AS FIRM_RLE
, SUBFIRM1.CHLD_SLLNG_AGMT_RLE AS SUBFIRM1_RLE
, CAST( SUBFIRM1.REL_STRT_DT AS DATE ) AS SUBFIRM1_FIRM_REL_STRT_DT
, CAST( SUBFIRM1.REL_END_DT AS DATE ) AS SUBFIRM1_FIRM_REL_END_DT
, SUBFIRM1.SLLNG_AGMT_STUS_DESC AS SUBFIRM1_STUS

FROM PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW SUBFIRM1

LEFT OUTER JOIN PROD_STND_VW.NM_VW NM
ON SUBFIRM1.CHLD_PRTY_ID = NM.PRTY_ID
AND NM.NM_END_DT = '9999-12-31 00:00:00.000000'
AND NM_TYP_CD = 'FULL'

WHERE SUBFIRM1.PARENT_SLLNG_AGMT_RLE IN ( 'OFF' , 'RTF' )
AND SUBFIRM1.CHLD_SLLNG_AGMT_RLE IN ( 'RTF' , 'CRP' )
AND SUBFIRM1.SLLNG_AGMT_STUS_CD = '01'

) SUBFIRM1

ON FIRM.FIRM_PRTY_ID = SUBFIRM1.FIRM_PRTY_ID
AND FIRM.FIRM_RLE = SUBFIRM1.FIRM_RLE


JOIN

(

SELECT SUBPRD.CHLD_BPID AS PRD_BPID
, SUBPRD.CHLD_PRTY_ID AS PRD_PRTY_ID
, CASE WHEN SUBPRD.CHLD_SLLNG_AGMT_RLE = 'PRD' AND TRIM(NM.LST_NM) = '' AND TRIM(NM.FRST_NM) = '' THEN COALESCE ( NM.FULL_NM , ' ' )
WHEN SUBPRD.CHLD_SLLNG_AGMT_RLE = 'PRD' THEN TRIM ( NM.LST_NM ) || ', ' || TRIM ( NM.FRST_NM )
ELSE NM.FULL_NM
END AS PRD_NM
, SUBPRD.STD_CONTR_TYP_CD AS PRD_STD_CONTR_TYP
, SUBPRD.CONTR_ID AS PRD_CONTR_ID
, SUBPRD.PARENT_BPID AS SUBFIRM1_BPID
, SUBPRD.PARENT_SLLNG_AGMT_RLE AS SUBFIRM1_RLE
, SUBPRD.PARENT_PRTY_ID AS SUBFIRM1_PRTY_ID
, SUBPRD.CHLD_SLLNG_AGMT_RLE AS CHLD_RLE
, CAST( SUBPRD.REL_STRT_DT AS DATE ) AS PRD_SUBFIRM1_REL_STRT_DT
, CAST( SUBPRD.REL_END_DT AS DATE ) AS PRD_SUBFIRM1_REL_END_DT
, SUBPRD.SLLNG_AGMT_STUS_DESC AS PRD_SUBFIRM1_STUS

FROM PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW SUBPRD

LEFT OUTER JOIN PROD_STND_VW.NM_VW NM
ON SUBPRD.CHLD_PRTY_ID = NM.PRTY_ID
AND NM.NM_END_DT = '9999-12-31 00:00:00.000000'
AND NM_TYP_CD = 'FULL'

WHERE SUBPRD.PARENT_SLLNG_AGMT_RLE IN ( 'OFF' , 'RTF' , 'CRP' )
AND SUBPRD.CHLD_SLLNG_AGMT_RLE IN ( 'PRD' , 'FA' , 'TPA' , 'REF' )
AND SUBPRD.SLLNG_AGMT_STUS_CD = '01'

) SUBPRD

ON SUBFIRM1.SUBFIRM1_PRTY_ID = SUBPRD.SUBFIRM1_PRTY_ID
AND SUBFIRM1.SUBFIRM1_RLE = SUBPRD.SUBFIRM1_RLE


LEFT OUTER JOIN BD BD
ON BD.PARENT_PRTY_ID = SUBPRD.PRD_PRTY_ID



LEFT OUTER JOIN

(

SELECT UNTPRD.CHLD_BPID AS UNTPRD_BPID
, UNTPRD.CHLD_PRTY_ID AS UNTPRD_PRTY_ID
, UNTPRD.STD_CONTR_TYP_CD AS UNTPRD_STD_CONTR_TYP
, UNTPRD.CONTR_ID AS UNTPRD_CONTR_ID
, UNTPRD.PARENT_BPID AS UNT_BPID_2
, CAST( UNTPRD.REL_STRT_DT AS DATE ) AS PRD_UNT_REL_STRT_DT
, CAST( UNTPRD.REL_END_DT AS DATE ) AS PRD_UNT_REL_END_DT
, UNTPRD.SLLNG_AGMT_STUS_DESC AS PRD_UNT_STUS
, COALESCE (UNT.AGY_PRTY_ID, 0) AS AGY_PRTY_ID
, UNT.UNT_BPID AS UNT_BPID
, UNT.UNT_PRTY_ID AS UNT_PRTY_ID
, UNT.UNT_NM AS UNT_NM
, UNT.UNT_STD_CONTR_TYP AS UNT_STD_CONTR_TYP
, UNT.UNT_CONTR_ID AS UNT_CONTR_ID
, UNT.UNT_AGY_REL_STRT_DT
, UNT.UNT_AGY_REL_END_DT
, UNT.UNT_STUS
, UNT.SMBKD_BPID AS SMBKD_BPID
, UNT.SMBKD_PRTY_ID AS SMBKD_PRTY_ID
, UNT.SMBKD_NM AS SMBKD_NM
, UNT.SMBKD_STD_CONTR_TYP AS SMBKD_STD_CONTR_TYP
, UNT.SMBKD_CONTR_ID AS SMBKD_CONTR_ID
, UNT.SMBKD_UNT_REL_STRT_DT
, UNT.SMBKD_UNT_REL_END_DT
, UNT.SMBKD_STUS
, UNT.MA_BPID AS MA_BPID
, UNT.MA_PRTY_ID AS MA_PRTY_ID
, UNT.MA_NM AS MA_NM
, UNT.MA_STD_CONTR_TYP AS MA_STD_CONTR_TYP
, UNT.MA_CONTR_ID AS MA_CONTR_ID
, UNT.MA_UNT_REL_STRT_DT
, UNT.MA_UNT_REL_END_DT
, UNT.MA_STUS
, 'D' AS PRD_DIRECT_TO_UNT_IND

FROM PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW UNTPRD

LEFT OUTER JOIN UNIT UNT
ON UNTPRD.PARENT_PRTY_ID = UNT.UNT_PRTY_ID

WHERE UNTPRD.PARENT_SLLNG_AGMT_RLE = 'UNT'
AND UNTPRD.CHLD_SLLNG_AGMT_RLE IN ( 'CRP' , 'SM' , 'BKD' , 'MA' , 'SA' , 'FA' , 'PRD' )
AND UNTPRD.SLLNG_AGMT_STUS_CD = '01'

) UNTPRD

ON UNTPRD.UNTPRD_PRTY_ID = SUBPRD.PRD_PRTY_ID
AND UNTPRD.AGY_PRTY_ID = FIRM.FIRM_PRTY_ID


;

*** Insert completed. 3612 rows added.
*** Total elapsed time was 7 seconds.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-


/***************** Error Handling ********************************/
.IF ERRORCODE <> 0 THEN .GOTO ERRORS
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
/***************** Error Handling ********************************/




-- LEVEL 4



INSERT INTO PROD_STND_TBLS.SALES_HIERARCHY_WRK






SELECT -- AGY
AGY.AGY_BPID
, AGY.AGY_PRTY_ID
, AGY.AGY_NM
, AGY.AGY_STD_CONTR_TYP
, AGY.AGY_LGCY_ID
, AGY.AGY_CONTR_ID
, AGY.AGY_STUS
-- GA
, AGY.GA_BPID
, AGY.GA_PRTY_ID
, AGY.GA_NM
, AGY.GA_STD_CONTR_TYP
, AGY.GA_CONTR_ID
, AGY.GA_AGY_REL_STRT_DT
, AGY.GA_AGY_REL_END_DT
, AGY.GA_STUS
-- UNIT
, UNTPRD.UNT_BPID
, UNTPRD.UNT_PRTY_ID
, UNTPRD.UNT_NM
, UNTPRD.UNT_STD_CONTR_TYP
, UNTPRD.UNT_CONTR_ID
, UNTPRD.UNT_AGY_REL_STRT_DT
, UNTPRD.UNT_AGY_REL_END_DT
, UNTPRD.UNT_STUS
-- SMBKD
, UNTPRD.SMBKD_BPID
, UNTPRD.SMBKD_PRTY_ID
, UNTPRD.SMBKD_NM
, UNTPRD.SMBKD_STD_CONTR_TYP
, UNTPRD.SMBKD_CONTR_ID
, UNTPRD.SMBKD_UNT_REL_STRT_DT
, UNTPRD.SMBKD_UNT_REL_END_DT
, UNTPRD.SMBKD_STUS
-- MA
, UNTPRD.MA_BPID
, UNTPRD.MA_PRTY_ID
, UNTPRD.MA_NM
, UNTPRD.MA_STD_CONTR_TYP
, UNTPRD.MA_CONTR_ID
, UNTPRD.MA_UNT_REL_STRT_DT
, UNTPRD.MA_UNT_REL_END_DT
, UNTPRD.MA_STUS
-- FIRM
, FIRM.FIRM_BPID
, FIRM.FIRM_PRTY_ID
, FIRM.FIRM_NM
, FIRM.FIRM_RLE
, FIRM.FIRM_STD_CONTR_TYP
, FIRM.FIRM_CONTR_ID
, FIRM.FIRM_AGY_REL_STRT_DT
, FIRM.FIRM_AGY_REL_END_DT
, FIRM.FIRM_STUS
-- SUB - ORG
, SUBFIRM1.SUBFIRM1_BPID
, SUBFIRM1.SUBFIRM1_PRTY_ID
, SUBFIRM1.SUBFIRM1_NM
, SUBFIRM1.SUBFIRM1_RLE
, SUBFIRM1.SUBFIRM1_STD_CONTR_TYP
, SUBFIRM1.SUBFIRM1_CONTR_ID
, SUBFIRM1.SUBFIRM1_FIRM_REL_STRT_DT
, SUBFIRM1.SUBFIRM1_FIRM_REL_END_DT
, SUBFIRM1.SUBFIRM1_STUS
-- SUB - ORG 2
, SUBFIRM2.SUBFIRM2_BPID
, SUBFIRM2.SUBFIRM2_PRTY_ID
, SUBFIRM2.SUBFIRM2_NM
, SUBFIRM2.SUBFIRM2_RLE
, SUBFIRM2.SUBFIRM2_STD_CONTR_TYP
, SUBFIRM2.SUBFIRM2_CONTR_ID
, SUBFIRM2.SUBFIRM2_SUBFIRM1_REL_STRT_DT
, SUBFIRM2.SUBFIRM2_SUBFIRM1_REL_END_DT
, SUBFIRM2.SUBFIRM2_STUS
-- BD
, BD.BD_BPID
, BD.BD_PRTY_ID
, BD.BD_NM
, BD.BD_STD_CONTR_TYP
, BD.BD_CONTR_ID
, BD.BD_PARENT_REL_STRT_DT
, BD.BD_PARENT_REL_END_DT
, BD.BD_STUS
-- CP
, NULL AS CP_BPID
, NULL AS CP_PRTY_ID
, NULL AS CP_NM
, NULL AS CP_STD_CONTR_TYP
, NULL AS CP_CONTR_ID
, NULL AS CP_PRD_REL_STRT_DT
, NULL AS CP_PRD_REL_END_DT
, NULL AS CP_STUS
-- PRD
, SUBPRD.PRD_BPID
, SUBPRD.PRD_PRTY_ID
, SUBPRD.PRD_NM
, SUBPRD.PRD_CONTR_ID
, SUBPRD.CHLD_RLE
, SUBPRD.PRD_STD_CONTR_TYP
, SUBPRD.PRD_SUBFIRM2_REL_STRT_DT AS PRD_REL_STRT_DT
, SUBPRD.PRD_SUBFIRM2_REL_END_DT AS PRD_REL_END_DT
, SUBPRD.PRD_SUBFIRM2_STUS AS PRD_STUS
, NULL AS PRD_FIRM_REL_STRT_DT
, NULL AS PRD_FIRM_REL_END_DT
, NULL AS PRD_FIRM_STUS
, NULL AS PRD_SUBFIRM1_REL_STRT_DT
, NULL AS PRD_SUBFIRM1_REL_END_DT
, NULL AS PRD_SUBFIRM1_STUS
, SUBPRD.PRD_SUBFIRM2_REL_STRT_DT
, SUBPRD.PRD_SUBFIRM2_REL_END_DT
, SUBPRD.PRD_SUBFIRM2_STUS
, UNTPRD.PRD_UNT_REL_STRT_DT
, UNTPRD.PRD_UNT_REL_END_DT
, UNTPRD.PRD_UNT_STUS
-- OTHER
, 'I' AS PRD_DIRECT_TO_AGY_IND
, UNTPRD.PRD_DIRECT_TO_UNT_IND
, '4' AS HIER_DEPTH
, 'Active' AS HIER_STUS



FROM DST AGY

JOIN

(

SELECT FIRM.CHLD_BPID AS FIRM_BPID
, FIRM.CHLD_PRTY_ID AS FIRM_PRTY_ID
, NM.FULL_NM AS FIRM_NM
, FIRM.STD_CONTR_TYP_CD AS FIRM_STD_CONTR_TYP
, FIRM.CONTR_ID AS FIRM_CONTR_ID
, FIRM.PARENT_BPID AS AGY_BPID
, FIRM.PARENT_PRTY_ID AS AGY_PRTY_ID
, FIRM.CHLD_SLLNG_AGMT_RLE AS FIRM_RLE
, CAST( FIRM.REL_STRT_DT AS DATE ) AS FIRM_AGY_REL_STRT_DT
, CAST( FIRM.REL_END_DT AS DATE ) AS FIRM_AGY_REL_END_DT
, FIRM.SLLNG_AGMT_STUS_DESC AS FIRM_STUS

FROM PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW FIRM

LEFT OUTER JOIN PROD_STND_VW.NM_VW NM
ON FIRM.CHLD_PRTY_ID = NM.PRTY_ID
AND NM.NM_END_DT = '9999-12-31 00:00:00.000000'
AND NM_TYP_CD = 'FULL'

WHERE FIRM.PARENT_SLLNG_AGMT_RLE = 'DST'
AND FIRM.CHLD_SLLNG_AGMT_RLE IN ( 'OFF' , 'RTF' , 'CRP' )
AND FIRM.SLLNG_AGMT_STUS_CD = '01'

) FIRM

ON FIRM.AGY_PRTY_ID = AGY.AGY_PRTY_ID


JOIN

(

SELECT SUBFIRM1.CHLD_BPID AS SUBFIRM1_BPID
, SUBFIRM1.CHLD_PRTY_ID AS SUBFIRM1_PRTY_ID
, NM.FULL_NM AS SUBFIRM1_NM
, SUBFIRM1.STD_CONTR_TYP_CD AS SUBFIRM1_STD_CONTR_TYP
, SUBFIRM1.CONTR_ID AS SUBFIRM1_CONTR_ID
, SUBFIRM1.PARENT_BPID AS FIRM_BPID
, SUBFIRM1.PARENT_PRTY_ID AS FIRM_PRTY_ID
, SUBFIRM1.PARENT_SLLNG_AGMT_RLE AS FIRM_RLE
, SUBFIRM1.CHLD_SLLNG_AGMT_RLE AS SUBFIRM1_RLE
, CAST( SUBFIRM1.REL_STRT_DT AS DATE ) AS SUBFIRM1_FIRM_REL_STRT_DT
, CAST( SUBFIRM1.REL_END_DT AS DATE ) AS SUBFIRM1_FIRM_REL_END_DT
, SUBFIRM1.SLLNG_AGMT_STUS_DESC AS SUBFIRM1_STUS

FROM PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW SUBFIRM1

LEFT OUTER JOIN PROD_STND_VW.NM_VW NM
ON SUBFIRM1.CHLD_PRTY_ID = NM.PRTY_ID
AND NM.NM_END_DT = '9999-12-31 00:00:00.000000'
AND NM_TYP_CD = 'FULL'

WHERE SUBFIRM1.PARENT_SLLNG_AGMT_RLE IN ( 'OFF' , 'RTF' )
AND SUBFIRM1.CHLD_SLLNG_AGMT_RLE IN ( 'RTF' , 'CRP' )
AND SUBFIRM1.SLLNG_AGMT_STUS_CD = '01'

) SUBFIRM1

ON FIRM.FIRM_PRTY_ID = SUBFIRM1.FIRM_PRTY_ID
AND FIRM.FIRM_RLE = SUBFIRM1.FIRM_RLE


JOIN

(

SELECT SUBFIRM2.CHLD_BPID AS SUBFIRM2_BPID
, SUBFIRM2.CHLD_PRTY_ID AS SUBFIRM2_PRTY_ID
, NM.FULL_NM AS SUBFIRM2_NM
, SUBFIRM2.STD_CONTR_TYP_CD AS SUBFIRM2_STD_CONTR_TYP
, SUBFIRM2.CONTR_ID AS SUBFIRM2_CONTR_ID
, SUBFIRM2.PARENT_BPID AS SUBFIRM1_BPID
, SUBFIRM2.PARENT_PRTY_ID AS SUBFIRM1_PRTY_ID
, SUBFIRM2.PARENT_SLLNG_AGMT_RLE AS SUBFIRM1_RLE
, SUBFIRM2.CHLD_SLLNG_AGMT_RLE AS SUBFIRM2_RLE
, CAST( SUBFIRM2.REL_STRT_DT AS DATE ) AS SUBFIRM2_SUBFIRM1_REL_STRT_DT
, CAST( SUBFIRM2.REL_END_DT AS DATE ) AS SUBFIRM2_SUBFIRM1_REL_END_DT
, SUBFIRM2.SLLNG_AGMT_STUS_DESC AS SUBFIRM2_STUS

FROM PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW SUBFIRM2

LEFT OUTER JOIN PROD_STND_VW.NM_VW NM
ON SUBFIRM2.CHLD_PRTY_ID = NM.PRTY_ID
AND NM.NM_END_DT = '9999-12-31 00:00:00.000000'
AND NM_TYP_CD = 'FULL'

WHERE SUBFIRM2.PARENT_SLLNG_AGMT_RLE IN ( 'RTF' )
AND SUBFIRM2.CHLD_SLLNG_AGMT_RLE IN ( 'CRP' )
AND SUBFIRM2.SLLNG_AGMT_STUS_CD = '01'

) SUBFIRM2

ON SUBFIRM1.FIRM_PRTY_ID = SUBFIRM2.SUBFIRM1_PRTY_ID
AND SUBFIRM1.FIRM_RLE = SUBFIRM2.SUBFIRM1_RLE


JOIN

(

SELECT SUBPRD.CHLD_BPID AS PRD_BPID
, SUBPRD.CHLD_PRTY_ID AS PRD_PRTY_ID
, CASE WHEN SUBPRD.CHLD_SLLNG_AGMT_RLE = 'PRD' AND TRIM(NM.LST_NM) = '' AND TRIM(NM.FRST_NM) = '' THEN COALESCE ( NM.FULL_NM , ' ' )
WHEN SUBPRD.CHLD_SLLNG_AGMT_RLE = 'PRD' THEN TRIM ( NM.LST_NM ) || ', ' || TRIM ( NM.FRST_NM )
ELSE NM.FULL_NM
END AS PRD_NM
, SUBPRD.STD_CONTR_TYP_CD AS PRD_STD_CONTR_TYP
, SUBPRD.CONTR_ID AS PRD_CONTR_ID
, SUBPRD.PARENT_BPID AS SUBFIRM2_BPID
, SUBPRD.PARENT_SLLNG_AGMT_RLE AS SUBFIRM2_RLE
, SUBPRD.PARENT_PRTY_ID AS SUBFIRM2_PRTY_ID
, SUBPRD.CHLD_SLLNG_AGMT_RLE AS CHLD_RLE
, CAST( SUBPRD.REL_STRT_DT AS DATE ) AS PRD_SUBFIRM2_REL_STRT_DT
, CAST( SUBPRD.REL_END_DT AS DATE ) AS PRD_SUBFIRM2_REL_END_DT
, SUBPRD.SLLNG_AGMT_STUS_DESC AS PRD_SUBFIRM2_STUS

FROM PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW SUBPRD

LEFT OUTER JOIN PROD_STND_VW.NM_VW NM
ON SUBPRD.CHLD_PRTY_ID = NM.PRTY_ID
AND NM.NM_END_DT = '9999-12-31 00:00:00.000000'
AND NM_TYP_CD = 'FULL'

WHERE SUBPRD.PARENT_SLLNG_AGMT_RLE IN ( 'OFF' , 'RTF' , 'CRP' )
AND SUBPRD.CHLD_SLLNG_AGMT_RLE IN ( 'PRD' , 'FA' , 'TPA' , 'REF' )
AND SUBPRD.SLLNG_AGMT_STUS_CD = '01'

) SUBPRD

ON SUBFIRM2.SUBFIRM2_PRTY_ID = SUBPRD.SUBFIRM2_PRTY_ID
AND SUBFIRM2.SUBFIRM2_RLE = SUBPRD.SUBFIRM2_RLE


LEFT OUTER JOIN BD BD
ON BD.PARENT_PRTY_ID = SUBPRD.PRD_PRTY_ID



LEFT OUTER JOIN

(

SELECT UNTPRD.CHLD_BPID AS UNTPRD_BPID
, UNTPRD.CHLD_PRTY_ID AS UNTPRD_PRTY_ID
, UNTPRD.STD_CONTR_TYP_CD AS UNTPRD_STD_CONTR_TYP
, UNTPRD.CONTR_ID AS UNTPRD_CONTR_ID
, UNTPRD.PARENT_BPID AS UNT_BPID_2
, CAST( UNTPRD.REL_STRT_DT AS DATE ) AS PRD_UNT_REL_STRT_DT
, CAST( UNTPRD.REL_END_DT AS DATE ) AS PRD_UNT_REL_END_DT
, UNTPRD.SLLNG_AGMT_STUS_DESC AS PRD_UNT_STUS
, COALESCE (UNT.AGY_PRTY_ID, 0) AS AGY_PRTY_ID
, UNT.UNT_BPID AS UNT_BPID
, UNT.UNT_PRTY_ID AS UNT_PRTY_ID
, UNT.UNT_NM AS UNT_NM
, UNT.UNT_STD_CONTR_TYP AS UNT_STD_CONTR_TYP
, UNT.UNT_CONTR_ID AS UNT_CONTR_ID
, UNT.UNT_AGY_REL_STRT_DT
, UNT.UNT_AGY_REL_END_DT
, UNT.UNT_STUS
, UNT.SMBKD_BPID AS SMBKD_BPID
, UNT.SMBKD_PRTY_ID AS SMBKD_PRTY_ID
, UNT.SMBKD_NM AS SMBKD_NM
, UNT.SMBKD_STD_CONTR_TYP AS SMBKD_STD_CONTR_TYP
, UNT.SMBKD_CONTR_ID AS SMBKD_CONTR_ID
, UNT.SMBKD_UNT_REL_STRT_DT
, UNT.SMBKD_UNT_REL_END_DT
, UNT.SMBKD_STUS
, UNT.MA_BPID AS MA_BPID
, UNT.MA_PRTY_ID AS MA_PRTY_ID
, UNT.MA_NM AS MA_NM
, UNT.MA_STD_CONTR_TYP AS MA_STD_CONTR_TYP
, UNT.MA_CONTR_ID AS MA_CONTR_ID
, UNT.MA_UNT_REL_STRT_DT
, UNT.MA_UNT_REL_END_DT
, UNT.MA_STUS
, 'D' AS PRD_DIRECT_TO_UNT_IND

FROM PROD_USIG_ACCESS_VW.SLLNG_AGMT_CMN_VW UNTPRD

LEFT OUTER JOIN UNIT UNT
ON UNTPRD.PARENT_PRTY_ID = UNT.UNT_PRTY_ID

WHERE UNTPRD.PARENT_SLLNG_AGMT_RLE = 'UNT'
AND UNTPRD.CHLD_SLLNG_AGMT_RLE IN ( 'CRP' , 'SM' , 'BKD' , 'MA' , 'SA' , 'FA' , 'PRD' )
AND UNTPRD.SLLNG_AGMT_STUS_CD = '01'

) UNTPRD

ON UNTPRD.UNTPRD_PRTY_ID = SUBPRD.PRD_PRTY_ID
AND UNTPRD.AGY_PRTY_ID = SUBFIRM2.SUBFIRM2_PRTY_ID


;

*** Insert completed. 2557 rows added.
*** Total elapsed time was 3 seconds.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-


/***************** Error Handling ********************************/
.IF ERRORCODE <> 0 THEN .GOTO ERRORS
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
/***************** Error Handling ********************************/

RENAME TABLE PROD_STND_TBLS.SALES_HIERARCHY TO PROD_STND_TBLS.SALES_HIERARCHY_TMP ;

*** Table has been renamed.
*** Total elapsed time was 2 seconds.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

/***************** Error Handling ********************************/
.IF ERRORCODE <> 0 THEN .GOTO ERRORS
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
/***************** Error Handling ********************************/

RENAME TABLE PROD_STND_TBLS.SALES_HIERARCHY_WRK TO PROD_STND_TBLS.SALES_HIERARCHY ;

*** Table has been renamed.
*** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

/***************** Error Handling ********************************/
.IF ERRORCODE <> 0 THEN .GOTO ERRORS
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
/***************** Error Handling ********************************/

RENAME TABLE PROD_STND_TBLS.SALES_HIERARCHY_TMP TO PROD_STND_TBLS.SALES_HIERARCHY_WRK ;

*** Table has been renamed.
*** Total elapsed time was 2 seconds.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

/***************** Error Handling ********************************/
.IF ERRORCODE <> 0 THEN .GOTO ERRORS
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
/***************** Error Handling ********************************/

COLLECT STATS PROD_STND_TBLS.SALES_HIERARCHY ;

*** Update completed. 113 rows changed.
*** Total elapsed time was 2 minutes and 29 seconds.


+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-

/***************** Error Handling ********************************/
.IF ERRORCODE <> 0 THEN .GOTO ERRORS
+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+---------+-
/***************** Error Handling ********************************/


.QUIT 0
*** You are now logged off from the DBC.
*** Exiting BTEQ...
*** RC (return code) = 0
script return code= 0

===============================================================
= Exit Status : 0
= Elapsed Time (hh:mm:ss) : 00:03:41
= Job CPU usage (ms) : 131
= Job Memory usage (kb) : 14128
= Thu 08/26/2021 01:36:48 EDT
===============================================================
